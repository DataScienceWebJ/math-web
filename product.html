<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MathGraph Pro</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="card">
    <div class="header">
      <h1>üìê MathGraph Pro</h1>
      <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
    </div>

    <p class="subtitle">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏: –≥—Ä–∞—Ñ–∏–∫–∏, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä, —Ñ—É–Ω–∫—Ü–∏–∏</p>

    <section class="input-section">
      <select id="examples" onchange="loadExample()">
        <option disabled selected>–ü—Ä–∏–º–µ—Ä—ã —Ñ—É–Ω–∫—Ü–∏–π</option>
        <option value="sin(x)">sin(x)</option>
        <option value="cos(x)">cos(x)</option>
        <option value="x^2">x¬≤</option>
        <option value="x^3">x¬≥</option>
        <option value="sqrt(x)">sqrt(x)</option>
        <option value="log(x)">log(x)</option>
        <option value="tan(x)">tan(x)</option>
        <option value="abs(x)">|x|</option>
        <option value="exp(x)">exp(x)</option>
        <option value="1/x">1/x</option>
      </select>

      <input type="text" id="functionInput" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: sin(x), x^2, log(x)" />
      <button onclick="plotFunction()">–ü–æ—Å—Ç—Ä–æ–∏—Ç—å</button>
    </section>

    <div class="button-row">
      <button onclick="clearPlot()">–û—á–∏—Å—Ç–∏—Ç—å</button>
      <button onclick="saveAsImage()">–°–∫–∞—á–∞—Ç—å PNG</button>
    </div>

    <div id="plot"></div>

    <hr>

    <section class="calculator">
      <h2>üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h2>
      <input type="text" id="calcInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä: 2+2*sin(3)" />
      <button onclick="calculateExpression()">–í—ã—á–∏—Å–ª–∏—Ç—å</button>
      <div id="calcResult"></div>
    </section>

    <p class="footer">–°–æ–∑–¥–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ üíô</p>
  </main>

  <script src="https://unpkg.com/function-plot"></script>
  <script>
    function plotFunction() {
      const input = document.getElementById("functionInput").value;
      try {
        functionPlot({
          target: "#plot",
          width: 700,
          height: 400,
          grid: true,
          data: [{ fn: input, sampler: 'builtIn', graphType: 'polyline' }]
        });
      } catch (err) {
        alert("–û—à–∏–±–∫–∞: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —Ñ—É–Ω–∫—Ü–∏–∏.");
      }
    }

    function loadExample() {
      const value = document.getElementById("examples").value;
      document.getElementById("functionInput").value = value;
      plotFunction();
    }

    function clearPlot() {
      document.getElementById("plot").innerHTML = "";
      document.getElementById("functionInput").value = "";
    }

    function toggleTheme() {
      document.body.classList.toggle("dark");
      const icon = document.querySelector(".theme-toggle");
      icon.textContent = document.body.classList.contains("dark") ? "üåû" : "üåô";
    }

    function saveAsImage() {
      const svg = document.querySelector("#plot svg");
      if (!svg) return alert("–°–Ω–∞—á–∞–ª–∞ –ø–æ—Å—Ç—Ä–æ–π—Ç–µ –≥—Ä–∞—Ñ–∏–∫.");

      const svgData = new XMLSerializer().serializeToString(svg);
      const canvas = document.createElement("canvas");
      const ctx = canvas.getContext("2d");
      const img = new Image();
      const svgBlob = new Blob([svgData], {type: "image/svg+xml;charset=utf-8"});
      const url = URL.createObjectURL(svgBlob);

      img.onload = function() {
        canvas.width = svg.clientWidth;
        canvas.height = svg.clientHeight;
        ctx.drawImage(img, 0, 0);
        URL.revokeObjectURL(url);

        const png = canvas.toDataURL("image/png");
        const link = document.createElement("a");
        link.download = "graph.png";
        link.href = png;
        link.click();
      };

      img.src = url;
    }

    function calculateExpression() {
      const expr = document.getElementById("calcInput").value;
      try {
        const result = math.evaluate(expr);
        document.getElementById("calcResult").innerHTML = "–†–µ–∑—É–ª—å—Ç–∞—Ç: <strong>" + result + "</strong>";
      } catch (e) {
        document.getElementById("calcResult").textContent = "–û—à–∏–±–∫–∞ –≤ –≤—ã—Ä–∞–∂–µ–Ω–∏–∏.";
      }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjs@11.11.0/lib/browser/math.min.js"></script>
</body>
</html>
